import type { GetServerSidePropsContext } from 'next';
import { getServerSession } from 'next-auth';
import { useSession } from 'next-auth/react';
import { serverSideTranslations } from 'next-i18next/serverSideTranslations';
import Head from 'next/head';

import nextI18nConfig from '@/../next-i18next.config.mjs';
import { MainLayout } from '@/components/common';
import { LandingView } from '@/components/home';
import { authOptions } from '@/pages/api/auth/[...nextauth]';
import type { NextPageWithLayout } from './_app';

const Home: NextPageWithLayout = () => {
  const { data: session } = useSession();

  if (session) {
    return (
      <>
        <Head>
          <title>Home -Terra</title>
          <meta name="description" content="Generated by create-t3-app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>
        <MainLayout>
          <div>Home placeholder</div>
        </MainLayout>
      </>
    );
  }

  return (
    <>
      <Head>
        <title>Welcome to Terra</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <LandingView />
    </>
  );
};

export default Home;

export const getServerSideProps = async (context: GetServerSidePropsContext) => {
  return {
    props: {
      session: await getServerSession(context.req, context.res, authOptions),
      ...(await serverSideTranslations(
        context.locale ?? '',
        ['common', 'navigation', 'landing'],
        nextI18nConfig,
        ['en'],
      )),
    },
  };
};
